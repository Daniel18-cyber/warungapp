<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WarungApp Dashboard</title>
  <link rel="stylesheet" href="style.css">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

  
</script>

  <script>
(async () => {
  const token = localStorage.getItem("token");

  if (!token) {
    window.location.href = "/login.html";
    return;
  }

  try {
    const res = await fetch("/me", {
      headers: {
        Authorization: "Bearer " + token
      }
    });

    const data = await res.json();

    if (data === false) {
      localStorage.removeItem("token");
      window.location.href = "/login.html";
    }
  } catch (err) {
    localStorage.removeItem("token");
    window.location.href = "/login.html";
  }
})();
</script>

  <div class="container">

    
    <aside class="sidebar">
      <h2 class="logo">üè™ WarungApp</h2>
      <nav>
        <a href="dashboard.html" class="active">üìä Dashboard</a>
        <a href="sales.html">üí∞ Sales</a>
        <a href="inventory.html">üì¶ Inventory</a>
        <a href="profile.html">üë§ Profile</a>

        
      <div class="sidebar-bottom">
        <button class="logout-btn">Logout</button>
     </div>

    
   <script>
document.addEventListener("DOMContentLoaded", () => {
  const logoutBtn = document.querySelector(".logout-btn");
  const modal = document.getElementById("logoutModal");
  const cancelBtn = document.getElementById("cancelLogout");
  const confirmBtn = document.getElementById("confirmLogout");

  logoutBtn.addEventListener("click", () => {
    modal.classList.remove("hidden");
  });

  cancelBtn.addEventListener("click", () => {
    modal.classList.add("hidden");
  });

  confirmBtn.addEventListener("click", () => {
    localStorage.removeItem("token");
    window.location.replace("/login.html");
  });
});
</script>


</script>

      </nav>
    </aside>


    
    <main class="main">
      <header>
        <h1>Ringkasan Laporan</h1>
        <p>Dashboard penjualan dan aktivitas warung Anda</p>
      </header>


     
      <section class="summary">
        <div class="card">
          <h3>Total Penjualan</h3>
          <p class="value" id="totalPenjualan">loading...</p>
        </div>

        <div class="card">
          <h3>Jumlah Transaksi</h3>
          <p class="value" id="totalPenjualan">loading...</p>
        </div>

        <div class="card">
          <h3>Rata-rata / Transaksi</h3>
          <p class="value" id="totalPenjualan">loading...</p>
        </div>
      </section>

      
      <section class="transactions" style="margin-top: 2rem;">

        
        <div class="new-transaction">
          <h3>Grafik Penjualan Bulanan</h3>
          <canvas id="salesChart"></canvas>
        </div>

        
        <div class="recent-transactions">
          <h3>Penjualan Berdasarkan Kategori</h3>
          <canvas id="categoryChart"></canvas>
        </div>

      </section>


      
      <section style="margin-top: 2rem;">
        <h3>Transaksi Terakhir</h3>
        <table>
          <thead>
            <tr>
              <th>Tanggal</th>
              <th>Produk</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>22 Jun</td>
              <td>Mie Instan</td>
              <td>Rp 25.000</td>
            </tr>
            <tr>
              <td>21 Jun</td>
              <td>Susu</td>
              <td>Rp 20.000</td>
            </tr>
            <tr>
              <td>20 Jun</td>
              <td>Telur</td>
              <td>Rp 30.000</td>
            </tr>
          </tbody>
        </table>
      </section>

    </main>

  </div>


<script>

const ctx = document.getElementById("salesChart");
new Chart(ctx, {
  type: "line",
  data: {
    labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
    datasets: [{
      label: "Penjualan",
      data: [120, 180, 230, 780, 350, 800],
      borderColor: "#2f4eff",
      backgroundColor: "rgba(47, 78, 255, 0.1)",
      borderWidth: 2,
      tension: 0.3,
      fill: true
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: { beginAtZero: true }
    }
  }
});



const ctx2 = document.getElementById("categoryChart");
new Chart(ctx2, {
  type: "pie",
  data: {
    labels: ["Makanan", "Minuman", "Lainnya"],
    datasets: [{
      data: [55, 30, 15],
      backgroundColor: ["#10b981", "#3b82f6", "#f59e0b"]
    }]
  }
});
</script>

<div id="logoutModal" class="modal hidden">
  <div class="modal-box">
    <h3>Yakin mau logout?</h3>
    <div class="modal-actions">
      <button id="cancelLogout" class="btn cancel">Batal</button>
      <button id="confirmLogout" class="btn danger">Logout</button>
    </div>
  </div>
</div>

<script>
async function loadDashboard() {
  const res = await fetch("/api/dashboard-summary");
  const data = await res.json();

  document.getElementById("totalPenjualan").innerText =
    "Rp " + Number(data.total_penjualan || 0).toLocaleString();

  document.getElementById("totalTransaksi").innerText =
    data.total_transaksi || 0;

  document.getElementById("rataRata").innerText =
    "Rp " + Number(data.rata_rata || 0).toLocaleString();
}

loadDashboard();
</script>

</body>
</html>
